<!doctype html>
<html lang="pt-br">
  <head>
    <title>PouPix - Metas</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/dropdown.css">
    <script src="/js/functions-nav.js"></script>

    <style>

      .card {
        margin: 15px 0;
      }
      .w-auto{
        width: 80px !important;
      }

    </style>
  </head>

  <body style="background: linear-gradient(176deg, rgba(80,137,145,1) 0%, rgba(201,237,214,1) 100%); background-repeat: no-repeat; background-size: cover;">
    
      <!-- cabecalho com barra de navegacao -->
      <div id="navbar-placeholder"></div>

    <main style="margin-top: 20px;">
      <div class="container" style="padding: 60px;">

        <div class="d-flex justify-content-end mb-3">
          <button id="btnEditar" class="btn me-2" style="background-color: #09BC8A;">Editar Limites<i class="bi bi-pencil-square ms-2"></i></button>
          <button id="btnSalvar" class="btn btn-success d-none">Salvar</button>
        </div>

        <div class="card">
          <div class="card-body d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Casa</span>
            <span class="text-muted small limite">R$ 500 / R$ 1000</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Alimentação</span>
            <span class="text-muted small limite">R$ 300 / R$ 800</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Transporte</span>
            <span class="text-muted small limite">R$ 100 / R$ 300</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Lazer</span>
            <span class="text-muted small limite">R$ 100 / R$ 300</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Saúde</span>
            <span class="text-muted small limite">R$ 100 / R$ 300</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Educação</span>
            <span class="text-muted small limite">R$ 100 / R$ 300</span>
          </div>
        </div>

        <div class="card text-center card-add" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#modalNovaMeta">
          <button type="button" class="btn btn-outline-light card-body fw-semibold">+ Outro</button>
        </div>

      </div>
    </main>

    <!-- Modal Nova Meta -->
    <div class="modal fade" id="modalNovaMeta" tabindex="-1" aria-labelledby="modalNovaMetaLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalNovaMetaLabel">Adicionar nova meta</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="text" class="form-control mb-2" placeholder="Nome da meta">
            <input type="number" class="form-control" placeholder="Limite da meta">
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button class="btn btn-primary">Adicionar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>

    <script>
        const btnEditar = document.getElementById('btnEditar');
        const btnSalvar = document.getElementById('btnSalvar');
      
        function atualizarCards() {
          return document.querySelectorAll('.card:not(.card-add)');
        }
      
        btnEditar.addEventListener('click', () => {
          btnEditar.classList.add('d-none');
          btnSalvar.classList.remove('d-none');
      
          atualizarCards().forEach(card => {
            card.style.opacity = '0.6';
            const limiteSpan = card.querySelector('.limite');
            if (limiteSpan) {
              const [gasto, limite] = limiteSpan.innerText.split('/');
              limiteSpan.innerHTML = `${gasto} / <input type="text" class="form-control form-control-sm d-inline w-auto" value="${limite.trim().replace('R$', '')}">`;
            }
          });
        });
      
        btnSalvar.addEventListener('click', () => {
          btnSalvar.classList.add('d-none');
          btnEditar.classList.remove('d-none');
      
          atualizarCards().forEach(card => {
            card.style.opacity = '1';
            const limiteSpan = card.querySelector('.limite');
            if (limiteSpan) {
              const gasto = limiteSpan.innerText.split('/')[0];
              const input = card.querySelector('input');
              if (input) {
                const novoLimite = input.value;
                limiteSpan.innerHTML = `${gasto} / R$ ${novoLimite}`;
              }
            }
          });
        });
      
        // Lógica para adicionar nova meta
        const modalNovaMeta = document.getElementById('modalNovaMeta');
        const btnAdicionar = modalNovaMeta.querySelector('.btn-primary');
        const inputNome = modalNovaMeta.querySelector('input[type="text"]');
        const inputLimite = modalNovaMeta.querySelector('input[type="number"]');
        const container = document.querySelector('.container');
      
        btnAdicionar.addEventListener('click', () => {
          const nome = inputNome.value.trim();
          const limite = inputLimite.value.trim();
      
          if (nome === '' || limite === '') return;
      
          const novoCard = document.createElement('div');
          novoCard.className = 'card';
          novoCard.innerHTML = `
            <div class="card-body d-flex justify-content-between align-items-center">
              <span class="fw-semibold">${nome}</span>
              <span class="text-muted small limite">R$ 0 / R$ ${limite}</span>
            </div>
          `;
      
          // Inserir antes do card "Outro"
          const cardOutro = document.querySelector('.card-add') || document.querySelector('.card.text-center');
          container.insertBefore(novoCard, cardOutro);
      
          inputNome.value = '';
          inputLimite.value = '';
      
          const modal = bootstrap.Modal.getInstance(modalNovaMeta);
          modal.hide();
        });
      </script>
      
  </body>
</html>
